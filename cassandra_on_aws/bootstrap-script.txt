#!/bin/bash

apt update
echo "********************* updated *********************"
apt-get install -y gnupg2 && \
apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 0xB1998361219BD9C9 && \
apt-get install -y software-properties-common && \
apt-add-repository 'deb http://repos.azulsystems.com/ubuntu stable main' && \
apt-get install -y zulu-8
echo "********************* java installed *********************"
echo "deb http://www.apache.org/dist/cassandra/debian 311x main" \
| sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list
echo "********************* deb done *********************"
sudo curl https://www.apache.org/dist/cassandra/KEYS | sudo apt-key add -
echo "********************* curl done *********************"
sudo apt update
echo "********************* update done *********************"
sudo apt install -y cassandra
echo "********************* cassandra installed *********************"
sudo service cassandra stop
echo "********************* service stopped *********************"
sudo rm -rf /var/lib/cassandra/data/system/*
sudo chmod 666 /etc/cassandra/cassandra.yaml
sudo sed -i -e "s/cluster_name: 'Test Cluster'/cluster_name: 'Cassandra cluster'/g" /etc/cassandra/cassandra.yaml
sudo sed -i 's/rpc_address: localhost/rpc_address: 0.0.0.0/g' /etc/cassandra/cassandra.yaml
echo "********************* cassandra is ready to start *********************"
